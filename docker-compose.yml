services:
  nginx:
    build:
      context: .
      dockerfile: Dockerfile.nginx
    ports:
      - '80:80'
    depends_on:
      - node
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: '10m'
        max-file: '3'
        compress: 'true'

  node:
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      - HOST=0.0.0.0
      - PORT=1234
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - LOG_RETENTION_DAYS=${LOG_RETENTION_DAYS:-7}
    expose:
      - '1234'
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: '10m'
        max-file: '3'
        compress: 'true'
