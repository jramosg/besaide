---
import { Address, Email, Phone, Socials } from '@/config/company';
import Logo from '@/components/Logo.astro';
import YoutubeIcon from '@/assets/icons/youtube.svg';
import XIcon from '@/assets/icons/x.svg';
import FacebookIcon from '@/assets/icons/facebook.svg';
import InstagramIcon from '@/assets/icons/instagram.png';
import { Image } from 'astro:assets';
import { getLangFromUrl, getUrlFromID, useTranslations } from '@/i18n/utils';
import Container from './Container.astro';
import { nav } from '@/config/nav';

const url = Astro.url;
const lang = getLangFromUrl(url);
const t = useTranslations(lang);

// Schema.org structured data for organization
const organizationSchema = {
	'@context': 'https://schema.org',
	'@type': 'Organization',
	name: 'Besaide Mendi Elkartea',
	address: {
		'@type': 'PostalAddress',
		streetAddress: Address.name
	},
	contactPoint: {
		'@type': 'ContactPoint',
		telephone: Phone.name,
		email: Email.name,
		contactType: 'customer service'
	},
	sameAs: [Socials.facebook, Socials.instagram]
};
---

<script
	type="application/ld+json"
	set:html={JSON.stringify(organizationSchema)}
/>

<footer
	class="footer"
	role="contentinfo"
	itemscope
	itemtype="https://schema.org/Organization"
>
	<Container class="footer__container">
		<div class="footer__branding">
			<Logo />
		</div>

		<section
			class="footer__section footer__section--address"
			aria-labelledby="footer-address-heading"
		>
			<h2 class="subtitle" id="footer-address-heading">{t('Helbidea')}</h2>
			<a
				href={Address.url}
				target="_blank"
				rel="noopener noreferrer"
				class="footer__link footer__link--address"
				itemprop="url"
			>
				<p class="footer__organization" itemprop="name">
					Besaide Mendi Elkartea
				</p>
				<address
					class="footer__address"
					itemprop="address"
					itemscope
					itemtype="https://schema.org/PostalAddress"
				>
					<span itemprop="streetAddress">{Address.name}</span>
				</address>
			</a>
		</section>

		<section
			class="footer__section footer__section--contact"
			aria-labelledby="footer-contact-heading"
		>
			<h2 class="subtitle" id="footer-contact-heading">
				{t('Kontaktua')}
			</h2>
			<div class="footer__contact-info">
				<a href={Phone.url} class="footer__link" itemprop="telephone">
					{t('Telefonoa') + ': ' + Phone.name}
				</a>
				<a href={Email.url} class="footer__link" itemprop="email">
					{t('Emaila') + ': ' + Email.name}
				</a>
				<p class="footer__office-hours">
					{
						t(
							'Jende aurreko arreta zerbitzua astearte eta asteazkenetan 19:30-tatik 20:30-tara.'
						)
					}
				</p>
			</div>
		</section>

		<nav
			class="footer__section footer__section--nav"
			aria-labelledby="footer-nav-heading"
		>
			<h2 class="subtitle" id="footer-nav-heading">{t('Nabigazioa')}</h2>
			<ul class="footer__nav-list">
				{
					nav.map(item =>
						item.children.length === 0 ? (
							<li class="footer__nav-item">
								<a
									href={getUrlFromID(item.slug, lang)}
									class="footer__nav-link"
								>
									{t(item.title)}
								</a>
							</li>
						) : (
							<li class="footer__nav-item footer__nav-item--has-children">
								<h3 class="footer__nav-subtitle">{t(item.title)}</h3>
								<ul class="footer__nav-sublist">
									{item.children.map(child => (
										<li class="footer__nav-subitem">
											<a
												href={getUrlFromID(child.slug, lang)}
												class="footer__nav-link"
											>
												{t(child.title)}
											</a>
										</li>
									))}
								</ul>
							</li>
						)
					)
				}
			</ul>
		</nav>

		<section
			class="footer__section footer__section--social"
			aria-labelledby="footer-social-heading"
		>
			<h2 class="subtitle" id="footer-social-heading">Sare sozialak</h2>
			<ul class="footer__social-list">
				<li class="footer__social-item">
					<a
						href={Socials.facebook}
						target="_blank"
						rel="noopener noreferrer"
						class="footer__social-link"
						aria-label="Bisitatu Besaide-ren Facebook orria"
						itemprop="sameAs"
					>
						<FacebookIcon width={24} height={24} aria-hidden="true" />
						<span>Facebook</span>
					</a>
				</li>
				<li class="footer__social-item">
					<a
						href="https://x.com/Besaideme"
						target="_blank"
						rel="noopener noreferrer"
						class="footer__social-link"
						aria-label="Bisitatu Besaide-ren X (Twitter) orria"
					>
						<XIcon
							fill="currentColor"
							width={24}
							height={24}
							aria-hidden="true"
						/>
						<span>X</span>
					</a>
				</li>
				<li class="footer__social-item">
					<a
						href="https://www.youtube.com/channel/UChcnKpJIpY-U1NaiIw09nNg"
						target="_blank"
						rel="noopener noreferrer"
						class="footer__social-link"
						aria-label="Bisitatu Besaide-ren YouTube kanala"
					>
						<YoutubeIcon width={24} height={24} aria-hidden="true" />
						<span>YouTube</span>
					</a>
				</li>
				<li class="footer__social-item">
					<a
						href={Socials.instagram}
						target="_blank"
						rel="noopener noreferrer"
						class="footer__social-link"
						aria-label="Bisitatu Besaide-ren Instagram orria"
						itemprop="sameAs"
					>
						<Image
							src={InstagramIcon}
							alt=""
							width={24}
							height={24}
							aria-hidden="true"
						/>
						<span>Instagram</span>
					</a>
				</li>
			</ul>
		</section>
	</Container>

	<div class="footer__bottom">
		<Container class="footer__bottom-container">
			<p class="footer__copyright">&copy; Besaide Mendizale Elkartea Â©2025</p>
			<nav class="footer__legal" aria-label="Legal navigation">
				<a
					href={getUrlFromID('cookies-policy', lang)}
					class="footer__legal-link"
				>
					Lege oharra / Pribatutasun politika
				</a>
			</nav>
		</Container>
	</div>
</footer>

<script>
	document.addEventListener('astro:page-load', () => {
		const cookiesAccepted = localStorage.getItem('cookies-accepted');
		// Cookie notice functionality removed - currently not in use
	});
</script>

<style>
	/* Base Footer Styles */
	.footer {
		background: var(--theme-footer-bg);
		position: relative;
		margin-top: var(--s6);
	}

	.footer__container {
		display: grid;
		grid-template-columns: repeat(3, 1fr);
		grid-template-rows: auto auto;
		padding-block: var(--s6);
		section,
		nav,
		.footer__branding {
			padding: var(--s4) var(--s4);
		}
	}

	/* Footer Branding */
	.footer__branding {
		height: fit-content;
		padding-bottom: var(--s2);
	}

	/* Footer Sections */
	.footer__section {
		display: flex;
		flex-direction: column;
		gap: var(--s3);
	}

	.footer__section--nav {
		grid-column: 2;
		grid-row: 2;
		a {
			text-decoration: underline;
		}
	}

	.footer__section--social {
		grid-column: 3;
		grid-row: 2;
	}

	.footer__section--address,
	.footer__section--contact {
		border-bottom: 1px solid var(--theme-outline);
	}

	/* Footer Links */
	.footer__link {
		text-decoration: none;
		color: inherit;
		transition:
			color var(--theme-transition),
			text-decoration var(--theme-transition);
	}

	.footer__link:hover,
	.footer__link:focus-visible {
		color: var(--theme-primary-800);
		text-decoration: underline;
	}

	/* Address Section */
	.footer__organization,
	.footer__address {
		margin: 0;
		line-height: 1.6;
	}

	.footer__address {
		font-style: normal;
	}

	/* Contact Section */
	.footer__contact-info {
		display: flex;
		flex-direction: column;
		gap: var(--s2);
	}

	.footer__office-hours {
		margin: 0;
	}

	/* Navigation Section */
	.footer__nav-list {
		list-style: none;
		padding: 0;
		margin: 0;
		column-count: 2;
		column-gap: var(--s4);
	}

	.footer__nav-sublist {
		list-style: none;
		padding: 0;
		margin: 0;
	}

	.footer__nav-item {
		margin-bottom: var(--s3);
		break-inside: avoid;
		page-break-inside: avoid;
	}

	.footer__nav-subitem {
		margin-bottom: var(--s2);
	}

	.footer__nav-subtitle {
		margin: 0 0 var(--s1) 0;
		font-size: 1rem;
		font-weight: 500;
	}

	.footer__nav-sublist {
		margin-left: var(--s4);
	}

	.footer__nav-link {
		color: inherit;
		text-decoration: none;
		transition:
			transform var(--theme-transition),
			color var(--theme-transition);
		display: inline-block;
	}

	.footer__nav-link:hover,
	.footer__nav-link:focus-visible {
		color: var(--theme-primary-800);
		transform: translateX(0.5rem);
	}

	/* Social Media Section */
	.footer__social-list {
		display: flex;
		flex-direction: column;
		gap: var(--s3);
		list-style: none;
		padding: 0;
		margin: 0;
	}

	.footer__social-item {
		margin: 0;
	}

	.footer__social-link {
		display: flex;
		align-items: center;
		gap: var(--s2);
		color: inherit;
		text-decoration: none;
		transition:
			color var(--theme-transition),
			transform var(--theme-transition);
		padding: var(--s1);
		margin-left: calc(var(--s1) * -1);
		border-radius: 4px;
	}

	.footer__social-link:hover,
	.footer__social-link:focus-visible {
		color: var(--theme-primary-800);
		transform: translateX(0.5rem);
	}

	/* Footer Bottom */
	.footer__bottom {
		padding-block: var(--s2);
		background: var(--theme-on-bg);
		color: var(--theme-bg);
		margin-top: var(--s4);
	}

	.footer__bottom-container {
		display: flex;
		justify-content: center;
		align-items: center;
		flex-wrap: wrap;
		gap: var(--s4);
		text-size: var(--font-size-sm);
	}

	.footer__copyright {
		margin: 0;
		border-right: 1px solid var(--theme-bg);
		padding: 0 var(--s4);
	}

	.footer__legal {
		display: flex;
		gap: var(--s4);
	}

	.footer__legal-link {
		text-decoration: none;
		transition: color var(--theme-transition);
		padding: var(--s1);
		border-radius: 4px;
	}

	.footer__legal-link:hover,
	.footer__legal-link:focus-visible {
		color: var(--theme-primary-800);
	}

	/* Responsive Design */
	@media (max-width: 768px) {
		.footer__container {
			grid-template-columns: 1fr;
			grid-template-rows: auto;
			gap: 0;
		}

		.footer__nav-list {
			column-count: 1;
		}

		.footer__section,
		.footer__branding {
			padding: var(--s5) 0;
		}

		.footer__section:not(:last-child),
		.footer__section--nav {
			border-bottom: 1px solid var(--theme-outline);
		}

		.footer__section--nav,
		.footer__section--social {
			grid-column: 1;
			grid-row: auto;
		}

		.footer__bottom-container {
			flex-direction: column;
			text-align: center;
		}

		.footer__copyright {
			border-right: none;
			padding: 0;
		}

		.footer__legal {
			flex-direction: column;
			align-items: center;
			gap: var(--s2);
		}
	}

	@media (max-width: 480px) {
		.footer {
			margin-top: var(--s5);
		}

		.footer__container {
			gap: 0;
		}

		.footer__social-list {
			gap: var(--s2);
		}

		.footer__nav-sublist {
			margin-left: var(--s4);
		}
	}

	/* High Contrast Mode Support */
	@media (prefers-contrast: high) {
		.footer__link:focus-visible,
		.footer__nav-link:focus-visible,
		.footer__social-link:focus-visible,
		.footer__legal-link:focus-visible {
			outline: 2px solid var(--theme-primary-800);
			outline-offset: 2px;
		}
	}

	/* Reduced Motion Support */
	@media (prefers-reduced-motion: reduce) {
		.footer__link,
		.footer__nav-link,
		.footer__social-link,
		.footer__legal-link {
			transition: none;
		}
	}
</style>
