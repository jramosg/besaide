---
import { Image } from 'astro:assets';
import { slugify } from '@/utils/string';
import { getLangFromUrl, getUrlFromID } from '@/i18n/utils';
import { formatEventDate } from '@/utils/date';
import type { ProcessedEvent } from '@/types/Events';
import Chip from '../Chip.astro';
import EventMetas from './EventMetas.astro';
import EventTypeIcon from './EventTypeIcon.astro';

type Props = {
	item: ProcessedEvent;
};

const lang = getLangFromUrl(Astro.url);

const { item } = Astro.props;

const startDate = new Date(item.data.date);
const endDate = item.data.endDate ? new Date(item.data.endDate) : null;
const formattedDate = formatEventDate(startDate, endDate, lang);

const eventId = slugify(item.id);

---

<a href={item.slug} class="card card--elevated event-card">
	<div class="event-image-container">
		<Image
			src={item.data.image}
			alt={item.data.title}
			class="event-image"
			style={`view-transition-name: image-${eventId}`}
		/>
		<div class="event-overlay"></div>
	</div>

	<div class="event-content">
		<div class="event-header">
			<Chip
				variant="default"
				style={`view-transition-name: date-chip-${eventId}`}
			>
				{formattedDate.toUpperCase()}
			</Chip>
			<EventTypeIcon item={item} />
		</div>
		<h3 class="event-title" style={`view-transition-name: title-${eventId}`}>
			{item.data.title}
		</h3>

		<div class="event-meta">
			<EventMetas item={item} />
		</div>
	</div>
</a>

<style>
	a {
		text-decoration: none;
		color: inherit;
	}

	.event-card {
		position: relative;
		min-height: 400px;
		display: flex;
		flex-direction: column;
		overflow: hidden;
	}

	.event-image-container {
		position: absolute;
		inset: 0;
		overflow: hidden;
		z-index: 0;
	}

	.event-image {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: transform 0.5s ease;
	}

	.event-card:hover .event-image {
		transform: scale(1.05);
	}

	.event-overlay {
		position: absolute;
		inset: 0;
		background: linear-gradient(
			to bottom,
			rgba(0, 0, 0, 0.3) 0%,
			rgba(0, 0, 0, 0.7) 100%
		);
	}

	.event-title {
		margin-bottom: 0;
		flex: 1;
	}

	.event-date-badge {
		background: var(--theme-card);
		color: var(--theme-on-bg);
		border-radius: 100px;
		padding: var(--s2);
		text-align: center;
	}

	.event-content {
		padding: var(--s4);
		position: relative;
		z-index: 1;
		display: flex;
		flex-direction: column;
		gap: var(--s2);
		color: white;
		height: 100%;
	}

	.event-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	.event-header :global(svg) {
		width: 1.5rem;
		height: 1.5rem;
		filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
	}

	.event-meta {
		display: grid;
		grid-template-columns: auto 1fr;
		column-gap: var(--s6);
		row-gap: var(--s2);
		margin-top: auto;
		align-items: end;
	}
</style>
