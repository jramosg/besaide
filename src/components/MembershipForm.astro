---
export const prerender = false;

import Input from '@/components/Input.astro';
import Checkbox from '@/components/Checkbox.astro';
import FormField from '@/components/FormField.astro';
import Button from '@/components/buttons/Button.astro';
import { getLangFromUrl, useTranslations } from '@/i18n/utils';
import '@/styles/form-shared.css';
import Container from './Container.astro';
import FormPrivacy from './FormPrivacy.astro';
import FormError from './FormError.astro';
import FormSection from './FormSection.astro';
import type { FormProps } from '@/types/Form';

type Props = FormProps;
const { errors, formData } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<FormSection aria-labelledby="form-title">
	<Container narrow>
		<h2 id="form-title" class="h4">
			{t('form.title')}
		</h2>

		<p class="form-instructions">
			{t('form.instructions')}
		</p>

		<form
			class="membership-form"
			id="membership-form"
			novalidate
			method="POST"
			enctype="application/x-www-form-urlencoded"
		>
			<!-- Section 1: Personal Data -->
			<fieldset class="form-section">
				<legend class="form-subtitle subtitle">
					{'1. ' + t('form.section.personal-data')}
				</legend>

				<div class="form-grid">
					<FormField
						label={t('form.field.dni')}
						htmlFor="dni"
						required
						class="form-field--full"
						errors={errors}
						name="dni"
					>
						<Input
							id="dni"
							name="dni"
							type="text"
							required={true}
							autocomplete="off"
							value={formData.dni}
						/>
					</FormField>

					<FormField
						label={t('form.field.name')}
						htmlFor="name"
						required
						class="form-field--full"
						errors={errors}
						name="name"
					>
						<Input
							id="name"
							name="name"
							type="text"
							required={true}
							autocomplete="given-name"
							value={formData.name}
						/>
					</FormField>

					<FormField
						label={t('form.field.surnames')}
						htmlFor="surnames"
						required
						class="form-field--full"
						errors={errors}
						name="surnames"
					>
						<Input
							id="surnames"
							name="surnames"
							type="text"
							required={true}
							autocomplete="family-name"
							value={formData.surnames}
						/>
					</FormField>

					<FormField
						label={t('form.field.birthdate')}
						htmlFor="birthdate"
						required
						class="form-field--full"
						errors={errors}
						name="birthdate"
					>
						<Input
							id="birthdate"
							name="birthdate"
							type="date"
							required={true}
							autocomplete="bday"
							value={formData.birthdate}
						/>
					</FormField>

					<FormField
						label={t('form.field.address')}
						htmlFor="address"
						required
						class="form-field--full"
						errors={errors}
						name="address"
					>
						<Input
							id="address"
							name="address"
							type="text"
							required={true}
							autocomplete="street-address"
							value={formData.address}
						/>
					</FormField>

					<FormField
						label={t('form.field.town')}
						htmlFor="town"
						required
						class="form-field--full"
						errors={errors}
						name="town"
					>
						<Input
							id="town"
							name="town"
							type="text"
							required={true}
							autocomplete="address-level2"
							value={formData.town}
						/>
					</FormField>

					<FormField
						label={t('form.field.postal-code')}
						htmlFor="postal-code"
						required
						class="form-field--full"
						errors={errors}
						name="postalCode"
					>
						<Input
							id="postal-code"
							name="postal-code"
							type="text"
							required={true}
							autocomplete="postal-code"
							value={formData.postalCode}
						/>
					</FormField>

					<FormField
						label={t('form.field.province')}
						htmlFor="province"
						required
						class="form-field--full"
						errors={errors}
						name="province"
					>
						<Input
							id="province"
							name="province"
							type="text"
							required={true}
							autocomplete="address-level1"
							value={formData.province}
						/>
					</FormField>

					<FormField
						label={t('form.field.phone1')}
						htmlFor="phone1"
						required
						class="form-field--half"
						errors={errors}
						name="phone1"
					>
						<Input
							id="phone1"
							name="phone1"
							type="tel"
							required={true}
							autocomplete="tel"
							value={formData.phone1}
						/>
					</FormField>

					<FormField
						label={t('form.field.phone2')}
						htmlFor="phone2"
						class="form-field--half"
						errors={errors}
						name="phone2"
					>
						<Input
							id="phone2"
							name="phone2"
							type="tel"
							autocomplete="tel"
							value={formData.phone2}
						/>
					</FormField>

					<FormField
						label={t('form.field.email')}
						htmlFor="email"
						required
						class="form-field--full"
						errors={errors}
						name="email"
					>
						<Input
							id="email"
							name="email"
							type="email"
							required={true}
							autocomplete="email"
							value={formData.email}
						/>
					</FormField>

					<div class="form-field form-field--full">
						<Checkbox
							id="info-spanish"
							checked={formData.infoSpanish}
							name="info-spanish"
							label={t('form.field.info-spanish')}
						/>
					</div>
				</div>
			</fieldset>

			<!-- Section 2: Membership -->
			<fieldset class="form-section form-section--row">
				<legend class="form-subtitle subtitle">
					{'2. ' + t('form.section.membership')}
				</legend>

				<div class="form-grid">
					<div class="form-field form-field--full">
						<Checkbox
							checked={formData.membership}
							id="membership"
							name="membership"
							label={t('Bai')}
						/>
					</div>
				</div>
			</fieldset>

			<!-- Section 3: Federation -->
			<fieldset class="form-section form-section--row">
				<legend class="form-subtitle subtitle">
					{'3. ' + t('form.field.federation') + ': '}
				</legend>

				<div class="form-grid">
					<div class="form-field form-field--full">
						<Checkbox
							checked={formData.federation}
							id="federation"
							name="federation"
							label={t('Bai')}
						/>
					</div>
				</div>
			</fieldset>

			<!-- Terms and Submit -->
			<footer class="form-footer">
				<FormPrivacy />
				<FormError message={errors.acceptTerms} />

				<Button type="submit" class="submit-button">
					{t('form.button.submit')}
				</Button>
			</footer>
		</form>
	</Container>
</FormSection>

<style>
	.form-instructions {
		text-align: center;
		margin-bottom: var(--s6);
		color: var(--theme-primary-900);
		font-size: var(--font-size-sm);
		font-weight: var(--font-weight-medium);
	}

	.membership-form {
		background-color: var(--theme-card);
		padding: var(--s6);
		border-radius: var(--theme-shape-radius);
		box-shadow: var(--shadow-card);
	}

	.form-section {
		margin-bottom: var(--s6);
	}

	.form-section:last-of-type {
		margin-bottom: var(--s4);
	}

	.form-section--row {
		display: flex;
		flex-direction: row;
		align-items: center;
		gap: var(--s4);
		legend {
			display: contents;
		}
	}

	.checkbox-legend {
		display: flex;
	}

	.form-subtitle {
		margin-bottom: var(--s6);
		padding: 0;
	}

	fieldset {
		border: none;
		padding: 0;
		margin: 0;
	}

	legend {
		padding: 0;
		margin-bottom: var(--s4);
	}

	.form-grid {
		display: grid;
		grid-template-columns: 1fr;
		gap: var(--s4);
	}

	@media (min-width: 768px) {
		.form-grid {
			grid-template-columns: repeat(2, 1fr);
		}

		.form-field--full {
			grid-column: 1 / -1;
		}

		.form-field--half {
			grid-column: span 1;
		}
	}

	.form-footer {
		padding-top: var(--s4);
		display: flex;
		flex-direction: column;
	}

	:global(.checkbox-wrapper) {
		padding: var(--s2) 0;
	}

	.submit-button {
		margin-top: var(--s2);
		align-self: center;
	}

	/* Responsive adjustments */
	@media (max-width: 767px) {
		.membership-form {
			padding: var(--s4);
		}
	}
</style>
