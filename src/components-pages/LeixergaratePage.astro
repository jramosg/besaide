---
import { CompanyName } from '@/config/company';
import Page from '@/layouts/Page.astro';

import { getLangFromUrl, useTranslations } from '@/i18n/utils';
import PageHeader from '@/components/PageHeader.astro';
import LeixegarateImage from '@/assets/images/leixagarate-aterpea.webp';
import HeroImage from '@/components/HeroImage.astro';
import ImageGallery from '@/components/ImageGallery.astro';
import { getEntry, render } from 'astro:content';
import type { ImageMetadata } from 'astro';
import LeafletMap from '@/components/LeafletMap.astro';
import RouteList from '@/components/RouteList.astro';
import LocationIcon from '@/assets/icons/location.svg';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const entry = await getEntry('leixergarateAterpea', 'leixergarate-aterpea');

const images = import.meta.glob<{ default: ImageMetadata }>(
	'/src/assets/images/leixegarate-aterpea/*.webp'
);

if (!entry) {
	throw new Error(`Content not found for leixergarateAterpea content ${lang}`);
}

const termsContentEntry = await getEntry(
	'leixergarateAterpeaTerms',
	'terms' + lang
);

const termsRender = termsContentEntry && (await render(termsContentEntry));

const coordinates = { lat: 42.97275, lon: -2.520117, elevation: 978 };
const coordinatesText = `N42º 58.365′ W2º 31.207′, ${coordinates.elevation}m`;
---

<Page
	seo={{
		title: t('Leixargarate aterpetxea') + ' - ' + CompanyName,
		description: t('leixagarate-aterpea.seo.description'),
		openGraphProps: {
			title: t('Leixargarate aterpetxea') + ' - ' + CompanyName,
			description: t('leixagarate-aterpea.seo.description'),
			image: LeixegarateImage.src
		}
	}}
>
	<script
		is:inline
		type="application/ld+json"
		set:html={JSON.stringify({
			'@context': 'https://schema.org',
			'@type': 'LodgingBusiness',
			name: 'Leixargarate Aterpetxea',
			description:
				lang === 'eu' ? entry.data.descriptionEu : entry.data.descriptionEs,
			image: new URL(LeixegarateImage.src, Astro.url).href,
			address: {
				'@type': 'PostalAddress',
				addressCountry: 'ES',
				addressRegion: 'Gipuzkoa'
			},
			geo: {
				'@type': 'GeoCoordinates',
				latitude: coordinates.lat,
				longitude: coordinates.lon,
				elevation: `${coordinates.elevation}m`
			},
			amenityFeature: [
				{
					'@type': 'LocationFeatureSpecification',
					name: 'Kitchen',
					value: true
				},
				{
					'@type': 'LocationFeatureSpecification',
					name: 'Fireplace',
					value: true
				},
				{
					'@type': 'LocationFeatureSpecification',
					name: 'Bathroom',
					value: true
				}
			],
			maximumAttendeeCapacity: 12,
			smokingAllowed: false,
			isAccessibleForFree: false
		})}
	/>
	<article
		class="content__container"
		itemscope
		itemtype="https://schema.org/LodgingBusiness"
	>
		<header>
			<PageHeader title={t('Leixargarate aterpetxea')} />
			<meta itemprop="name" content="Leixargarate Aterpetxea" />
		</header>

		<HeroImage
			src={LeixegarateImage}
			alt={`${t('Leixargarate aterpetxea')} - ${t('leixagarate-aterpea.seo.description')}`}
			slug="leixargarate-aterpea"
		/>
		<section aria-labelledby="description-heading">
			<h2 id="description-heading" class="h4">{t('Deskribapena')}</h2>
			<p itemprop="description">
				{lang === 'eu' ? entry.data.descriptionEu : entry.data.descriptionEs}
			</p>
		</section>
		{
			termsRender && (
				<section aria-labelledby="terms-heading">
					<h2 id="terms-heading" class="h4">
						{t('Baldintzak')}
					</h2>
					{termsRender && <termsRender.Content />}
				</section>
			)
		}

		<section aria-labelledby="prices-heading">
			<h2 id="prices-heading" class="h4">{t('Prezioak')}</h2>
			<dl class="price-list">
				{
					entry.data.prices.map(price => {
						const isDescription =
							(price.descriptionEu && lang === 'eu') ||
							(price.descriptionEs && lang === 'es');
						return (
							<>
								<dt
									class:list={[
										'price-label',
										'subtitle2',
										isDescription ? '' : 'row-border'
									]}
									itemscope
									itemtype="https://schema.org/Offer"
								>
									<span itemprop="name">
										{lang === 'eu' ? price.labelEu : price.labelEs}
									</span>
								</dt>
								<dd
									class:list={[
										'price-value',
										isDescription ? '' : 'row-border'
									]}
								>
									<span itemprop="price">
										{lang === 'eu' ? price.priceEu : price.priceEs}
									</span>
									<meta itemprop="priceCurrency" content="EUR" />
									<meta
										itemprop="availability"
										content="https://schema.org/InStock"
									/>
								</dd>
								{isDescription && (
									<dd
										itemprop="priceSpecification"
										class="price-description row-border"
									>
										{lang === 'eu' ? price.descriptionEu : price.descriptionEs}
									</dd>
								)}
							</>
						);
					})
				}
			</dl>
		</section>

		{
			(entry.data.contributionEu && lang === 'eu') ||
			(entry.data.contributionEs && lang === 'es') ? (
				<section aria-labelledby="contribution-heading">
					<h2 id="contribution-heading" class="h4">
						{t('Berrikuntzak')}
					</h2>
					<p>
						{lang === 'eu'
							? entry.data.contributionEu
							: entry.data.contributionEs}
					</p>
				</section>
			) : null
		}

		<section aria-labelledby="gallery-heading">
			<h2 id="gallery-heading" class="h4">{t('Argazki galeria')}</h2>
			<ImageGallery images={images} alt={t('nav.leixagarate-aterpea')} />
		</section>

		<section class="leixergarate-routes" aria-labelledby="routes-heading">
			<h2 id="routes-heading" class="h4">{t('nav.routes')}</h2>
			<RouteList filterLeixargarate={true} />
		</section>
		<section
			aria-labelledby="location-heading"
			itemscope
			itemtype="https://schema.org/Place"
		>
			<h2 id="location-heading" class="h4">{t('Kokapena')}</h2>
			<div class="location-grid">
				<div
					class="leaflet-map-container"
					role="region"
					aria-label={t('Kokapena')}
					aria-describedby="location-heading"
				>
					<LeafletMap
						latitude={coordinates.lat}
						longitude={coordinates.lon}
						zoom={15}
						markerComponent=`<a href="https://www.google.com/maps/@${coordinates.lat},${coordinates.lon},16z" target="_blank" rel="noopener noreferrer" aria-label="${t('Kokapena')} - Google Maps">Leixegarate Aterpea</a>`
					/>
				</div>
				<div class="coordinates-grid">
					<LocationIcon fill="var(--theme-primary-900)" aria-hidden="true" />
					<p>{t('Leixargarate aterpetxea')}</p>
					<p>
						<data
							value={`${coordinates.lat},${coordinates.lon}`}
							itemprop="geo"
							itemscope
							itemtype="https://schema.org/GeoCoordinates"
						>
							<meta itemprop="latitude" content={coordinates.lat.toString()} />
							<meta itemprop="longitude" content={coordinates.lon.toString()} />
							<meta
								itemprop="elevation"
								content={`${coordinates.elevation}m`}
							/>
							{coordinatesText}
						</data>
					</p>
				</div>
			</div>
		</section>
	</article>
	<section
		class="leixergarate-footer"
		role="region"
		aria-label="Call to action"
	>
		<p class="h4 leixergarate-footer-text">
			{
				t(
					'Animatu zaitez asteburua mendian igarotzera, familia edo lagun artean!'
				)
			}
		</p>
	</section>

	<style>
		.leixagarate-image {
			width: 100%;
			height: auto;
			border-radius: var(--border-radius-lg);
			margin-top: var(--s4);
		}

		section:not(:last-of-type) {
			margin-bottom: var(--s6);
		}

		.leaflet-map-container {
			width: 100%;
			height: 400px;
			border-radius: var(--theme-shape-radius);
			overflow: hidden;
		}

		.price-list {
			display: grid;
			grid-template-columns: auto 1fr;
			row-gap: var(--s3, 1rem);
		}

		.price-label {
			grid-column: 1;
			padding-bottom: var(--s2, 0.5rem);
		}

		.row-border {
			border-bottom: 1px solid var(--theme-separator);
		}

		.price-value {
			display: flex;
			gap: var(--s, 0.5rem);
			align-items: baseline;
			color: var(--theme-primary-900);
			flex-shrink: 0;
			white-space: nowrap;
			grid-column: 2;
			padding-bottom: var(--s2, 0.5rem);
			width: 100%;
			justify-content: flex-end;
			font-weight: var(--font-weight-semibold);
		}

		.prices-note {
			font-weight: var(--font-weight-semibold);
			color: var(--theme-primary-900);
			margin-top: var(--s4);
			font-size: var(--font-size-base);
			display: block;
		}

		.leixergarate-footer {
			background-color: var(--theme-primary-container-alt);
			min-height: 164px;
			color: var(--theme-primary-900);
			display: flex;
			align-items: center;
			justify-content: center;
			padding: var(--s6);
			width: 100%;
			margin-top: var(--s6);
			margin-bottom: calc(var(--footer-margin-top) * -1);
		}

		.leixergarate-footer p {
			margin: 0;
			text-align: center;
		}

		.location-grid {
			display: grid;
			grid-template-columns: 5fr 2fr;
			align-items: center;
			gap: var(--s8);
		}

		.coordinates-grid {
			display: grid;
			grid-template-columns: auto 1fr;
			align-items: center;
			gap: var(--s4);
			p {
				margin: 0;
			}
			:nth-child(3) {
				grid-column: 2;
			}
		}

		:global([data-theme='dark']) .leixergarate-footer {
			color: var(--theme-on-bg);
		}

		.leixergarate-footer-text {
			font-weight: var(--font-weight-normal);
		}

		.price-description {
			grid-column: 1 / span 2;
			margin-top: calc(var(--s4) * -1);
			font-size: var(--font-size-);
			padding-bottom: var(--s2);
		}

		@media (max-width: 600px) {
			.location-grid {
				display: flex;
				flex-direction: column-reverse;
				align-items: flex-start;
				gap: var(--s4);
			}
			.leaflet-map-container {
				height: 300px;
			}
		}
	</style>
</Page>
