---
import Page from '@/layouts/Page.astro';
import { formatDate, getLangFromUrl, getUrlFromID } from '@/i18n/utils';
import { slugify } from '@/utils/string';
import { getEntry, render } from 'astro:content';
import { Image } from 'astro:assets';
import { processNewsItem } from '@/staticPathsHelper';

const { post } = Astro.props;
const lang = getLangFromUrl(Astro.url);

const newsSection = getUrlFromID('news', lang);
const processedPost = await processNewsItem(post, lang, newsSection);

// Get the content
const contentId = post.id + '/content' + lang;
const entry = await getEntry('newsContent', contentId);
if (!entry) {
	throw new Error(`Content not found for ${contentId}`);
}
const { Content } = await render(entry);

const slug = slugify(post.id);
---

<Page pageClass="content__container single-news">
	<article class="single-article">
		{
			processedPost.processedImage ? (
				<header class="hero">
					<Image
						src={processedPost.processedImage}
						style={`view-transition-name: image-${slug}`}
						alt={processedPost.title}
					/>
				</header>
			) : null
		}

		<div class="content__container content__container--narrow">
			<h1 class="title" style={`view-transition-name: title-${slug}`}>
				{processedPost.title}
			</h1>
			<time class="meta" style={`view-transition-name: date-${slug}`}
				>{formatDate(post.data.date)}</time
			>

			<section class="content">
				<Content />
			</section>
		</div>
	</article>
</Page>

<style>
	.single-article .hero img {
		width: 100%;
		height: auto;
		display: block;
		object-fit: cover;
		max-height: 420px;
	}

	.article-body.container {
		max-width: 800px;
		margin: 0 auto;
		padding: var(--s6) 1rem;
	}

	.title {
		font-size: 2rem;
		margin: var(--s3) 0 var(--s2);
	}

	.meta {
		color: var(--theme-text-secondary);
		font-size: 0.9rem;
		margin-bottom: var(--s2);
	}

	.summary {
		font-weight: 600;
		margin-bottom: var(--s3);
		color: var(--theme-text);
	}

	.content :global(p) {
		line-height: 1.7;
		margin-bottom: var(--s3);
	}

	.content :global(a) {
		color: var(--theme-accent);
	}

	@media (max-width: 768px) {
		.title {
			font-size: 1.5rem;
		}
		.single-article .hero img {
			max-height: 240px;
		}
	}
</style>
